## 区块数据分析的调研结果

对于研究的设想，是通过分析地址上的 magic 代币在一段时间内的分布，来确定以月/年为单位的收支情况，因此我们需要的数据源是某个地址的 FILTERED BY TOKEN HOLDER(magic)，在这些数据中，通过每一个不同游戏的合约进行筛选和重新组合，来最终确定某个游戏，以月/年为单位的收支情况。

**由于 opensea 已经上线 arbitrum 暂时忽略，仅研究以 magic 计价的游戏**

因此重要的工作在于可以下载正确的区块数据，并重新筛选组合，第一个研究的方向就是如何下载某个地址的区块数据。

**先确定结论**

自己下载区块数据，然后导入到数据清洗脚本中做一次清洗，筛选，重组后存入数据库中，账本应用将使用数据库中的数据进行分类展示。

![](./images/arb-01.png)


### 全节点

这一项工作其实对于商业化来说是必要过程，由自己来维护全节点，并且将区块数据实时的同步到文档节点中，自己维护区块数据。

### nansen

Alex Svanevik 创建了 [https://github.com/blockchain-etl/public-datasets](https://github.com/blockchain-etl/public-datasets) 这是对区块数据进行 ETL 的工具。

> ETL (extract transform load) 是将多个系统中的数据组合到单个数据库，数据存储空间，数据仓库的传统方法。

> Alex Svanevik 是 [https://www.nansen.ai/](https://www.nansen.ai/) 的 CTO

上述的数据集都放置在 BigQuery 中，并对所有人开放，所有人都可以通过 BigQuery 来访问，解析区块链上的数据。

### etherscan

[https://etherscan.io/](https://etherscan.io/) 提供对常规区块数据的 APIs 服务，并且有收费定制版本

> [https://docs.etherscan.io/](https://docs.etherscan.io/)

由于我们的研究是在 arbitrum 上，[https://arbiscan.io/](https://arbiscan.io/) 提供的数据 APIs 受到限制

### dune

https://dune.com/ 也是一家提供数据查询的服务提供商，他们将区块数据重新整合，写入了数据库，并提供 SQL 查询，对于 arbitrum 的 APIs 支持没有。


## 清洗数据的方法

如果是常规的去遍历区块，在这里只能知道这是一种购买行为，且无法知道 Tokens Transferred 内部交易的细节，`debug_traceTransaction` 如 Alchemy 端点只提供在 Rinkeby Goerli 测试网中。

[https://dashboard.alchemy.com/enhanced-apis#debug-api](https://dashboard.alchemy.com/enhanced-apis#debug-api)

从 `arbiscan` 上导出的格式如下：

"Txhash","Blockno","UnixTimestamp","DateTime","From","To","Quantity","Method"

这里 `arbiscan` 将内部交易也转换成了数据，但是只能知道购买行为，但是无法知道买了什么，更不知道属于什么游戏，如果用这一份数据，只能简单的进行 magic 代币的数据加减法。

![image](./images/arb-02.png)

造假数据后存入 LEANCLOUD

![image](./images/arb-03.png)

**补充说明**

以 `elleria` 游戏为例，现有的 arbiscan 上下载的数据无法进行清洗，缺少了一些关键数据进行逻辑判断。

通过区块上的数据无法知道下列几个属性

- 无法知道 NFT ｜ Token 的目标合约
  - 无法确定这一笔交易属于 elleria 还是别的游戏
  - 无法更近一步的了解到来源于 trove 还是 magicswap
- 通过合约和地址进一步的筛选
  - 判断合约 === ELLERIA_HEROS 是 elleria 游戏中的英雄
  - 判断合约 === ELLERIA_RELICS 是 elleria 游戏中的文物
  - 判断合约 === ELLERIA_ELM 是 elleria 的 Token
  - 判断 From === ELLERIA_WB 是 elleria 的 world boss 事件
  - 通过上述几个合约或地址，可以在数据上可以将 elleria 相关的数据筛选出来
  - 由于的区块数据归集后的数据，无非进行匹配，数据中不会露出上述的数据，不能进行筛选
- 通过 To 这个字段可以判断是收入还是支出，如果 To 等于当前查询的目标地址，就是收入

这些内部交易无法获取，需要下载全节点才行。